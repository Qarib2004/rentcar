
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


enum UserRole {
  CLIENT
  OWNER
  ADMIN
}

enum BookingStatus {
  PENDING
  CONFIRMED
  ACTIVE
  COMPLETED
  CANCELLED
  REJECTED
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  REFUNDED
}

enum CarStatus {
  AVAILABLE
  RENTED
  MAINTENANCE
  UNAVAILABLE
}

enum TransmissionType {
  MANUAL
  AUTOMATIC
}

enum FuelType {
  PETROL
  DIESEL
  ELECTRIC
  HYBRID
}


model User {
  id            String    @id @default(uuid())
  email         String    @unique
  password      String
  firstName     String
  lastName      String
  phone         String?
  avatar        String?
  role          UserRole  @default(CLIENT)
  isVerified    Boolean   @default(false)
  isActive      Boolean   @default(true)
  
  licenseNumber String?
  licenseExpiry DateTime?
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  ownedCars     Car[]     @relation("CarOwner")
  bookings      Booking[] @relation("UserBookings")
  reviews       Review[]  @relation("UserReviews")
  sentMessages  Message[] @relation("MessageSender")
  payments      Payment[]
  notifications Notification[]

  @@map("users")
}

model Category {
  id          String   @id @default(uuid())
  name        String   @unique
  slug        String   @unique
  description String?
  icon        String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  cars        Car[]

  @@map("categories")
}

model Car {
  id              String           @id @default(uuid())
  ownerId         String
  categoryId      String
  
  brand           String
  model           String
  year            Int
  color           String
  licensePlate    String           @unique
  vin             String?          @unique
  
  transmission    TransmissionType
  fuelType        FuelType
  seats           Int
  doors           Int
  
  engineCapacity  Float?
  horsePower      Int?
  mileage         Int              @default(0)
  
  pricePerDay     Decimal          @db.Decimal(10, 2)
  pricePerHour    Decimal?         @db.Decimal(10, 2)
  deposit         Decimal          @db.Decimal(10, 2)
  
  description     String?
  images          String[]
  
  location        String
  latitude        Float?
  longitude       Float?
  
  features        String[]        
  
  status          CarStatus        @default(AVAILABLE)
  isActive        Boolean          @default(true)
  
  averageRating   Float            @default(0)
  totalReviews    Int              @default(0)
  
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  
  owner           User             @relation("CarOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  category        Category         @relation(fields: [categoryId], references: [id])
  bookings        Booking[]
  reviews         Review[]

  @@index([ownerId])
  @@index([categoryId])
  @@index([status])
  @@map("cars")
}

model Booking {
  id              String        @id @default(uuid())
  userId          String
  carId           String
  
  startDate       DateTime
  endDate         DateTime
  
  pricePerDay     Decimal       @db.Decimal(10, 2)
  totalDays       Int
  totalPrice      Decimal       @db.Decimal(10, 2)
  deposit         Decimal       @db.Decimal(10, 2)
  
  status          BookingStatus @default(PENDING)
  
  notes           String?
  pickupLocation  String?
  returnLocation  String?
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  confirmedAt     DateTime?
  cancelledAt     DateTime?
  completedAt     DateTime?
  
  user            User          @relation("UserBookings", fields: [userId], references: [id], onDelete: Cascade)
  car             Car           @relation(fields: [carId], references: [id], onDelete: Cascade)
  payment         Payment?
  review          Review?
  chatRoom        ChatRoom?

  @@index([userId])
  @@index([carId])
  @@index([status])
  @@index([startDate, endDate])
  @@map("bookings")
}

model Payment {
  id              String        @id @default(uuid())
  bookingId       String        @unique
  userId          String
  
  stripePaymentId String?       @unique
  stripeSessionId String?       @unique
  
  amount          Decimal       @db.Decimal(10, 2)
  currency        String        @default("USD")
  
  status          PaymentStatus @default(PENDING)
  
  paymentMethod   String?
  description     String?
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  paidAt          DateTime?
  refundedAt      DateTime?
  
  booking         Booking       @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@map("payments")
}

model Review {
  id          String   @id @default(uuid())
  bookingId   String   @unique
  userId      String
  carId       String
  
  rating      Int      
  comment     String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  booking     Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  user        User     @relation("UserReviews", fields: [userId], references: [id], onDelete: Cascade)
  car         Car      @relation(fields: [carId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([carId])
  @@index([rating])
  @@map("reviews")
}

model ChatRoom {
  id          String    @id @default(uuid())
  bookingId   String    @unique
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  booking     Booking   @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  messages    Message[]

  @@map("chat_rooms")
}

model Message {
  id          String   @id @default(uuid())
  chatRoomId  String
  senderId    String
  
  content     String
  isRead      Boolean  @default(false)
  
  createdAt   DateTime @default(now())
  readAt      DateTime?
  
  chatRoom    ChatRoom @relation(fields: [chatRoomId], references: [id], onDelete: Cascade)
  sender      User     @relation("MessageSender", fields: [senderId], references: [id], onDelete: Cascade)

  @@index([chatRoomId])
  @@index([senderId])
  @@map("messages")
}

model Notification {
  id        String   @id @default(uuid())
  userId    String
  
  title     String
  message   String
  type      String   
  data      Json?    
  
  isRead    Boolean  @default(false)
  
  createdAt DateTime @default(now())
  readAt    DateTime?
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
  @@map("notifications")
}